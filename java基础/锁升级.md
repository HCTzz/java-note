# 锁升级过程（存在对象markword中）
synchronized 是可重入锁。

1、偏向锁/自旋锁  记录在LR（lock record）中。进栈出栈，第一个LR中保存着markword信息。
2、重量级锁是在monitor字段上。
3、有线程竞争偏向锁升级轻量级锁
4、轻量级锁升级到重量级锁
	- 1.6之前使用-XX:PreBlockSpin 配置自旋升级次数，默认是10次。1.6之后由JVM自适应自旋机制控制。
	- 自旋锁是占用CPU时间的
5、重量级锁：
	- 包含多个队列：竞争队列，等待队列（所有拿不到锁的放入等待队列，不消耗CPU资源）...
6、当明确知道存在多线程竞争的情况下，偏向锁会涉及锁撤销，这时候不要启动偏向锁，直接使用自旋锁。
	- -XX:BiasedLockingStartupDelay=0 偏向锁启动延时。默认是4S
	- -XX:-UseBiasedLocking
	- -XX:+UseHeavyMonitors 
	
                             --------------------------------------------------------------------
                            |                                                                    |
                            |															         |
                            |															         |	
                            |													------------> 轻量级锁（自旋锁/用户空间锁）						
       偏向锁未启动			|		synchronized								|				 |
      ------------------> 普通对象  ------------								|轻度竞争（并    |
      |                        					|								|撤销偏向锁）    |
      |											|			（用户空间锁）		|	             |				
new --                                          | --------> 偏向锁 -------------                 |
      |                                         |              |                                 |
      |                                         |              |                                 |
	  ------------------> 匿名偏向锁 -----------               | 重度竞争（耗时过长，wait等）
	  偏向锁已启动    没有偏向任何一个线程                     -----------------------------> 重量级锁（需要向内核申请）
	  
	  
	  
	  